@model CMCSWeb.Models.Claim
@{
    ViewData["Title"] = "Claim Details";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-6"><i class="bi bi-eye text-primary"></i> Claim Details</h1>
        <a asp-action="Manage" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Claims
        </a>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-file-text"></i> Claim #@Model.Id
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Lecturer Name</label>
                                <p class="form-control-plaintext">@Model.User?.FullName</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Department</label>
                                <p class="form-control-plaintext">@Model.User?.Department</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Hours Worked</label>
                                <p class="form-control-plaintext">@Model.HoursWorked hours</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Hourly Rate</label>
                                <p class="form-control-plaintext">@Model.HourlyRate.ToString("C")</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Total Amount</label>
                                <p class="form-control-plaintext fw-bold text-success fs-5">@Model.TotalAmount.ToString("C")</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Documentation</label>
                        <div class="border rounded p-3 bg-light">
                            @if (string.IsNullOrEmpty(Model.Documentation))
                            {
                                <span class="text-muted">No documentation provided</span>
                            }
                            else
                            {
                                @Model.Documentation
                            }
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Status</label>
                                <div>
                                    @switch (Model.Status)
                                    {
                                        case CMCSWeb.Models.ClaimStatus.Pending:
                                            <span class="badge bg-warning fs-6"><i class="bi bi-clock"></i> Pending Verification</span>
                                            break;
                                        case CMCSWeb.Models.ClaimStatus.Verified:
                                            <span class="badge bg-info fs-6"><i class="bi bi-check-circle"></i> Verified</span>
                                            break;
                                        case CMCSWeb.Models.ClaimStatus.Approved:
                                            <span class="badge bg-success fs-6"><i class="bi bi-award"></i> Approved</span>
                                            break;
                                        case CMCSWeb.Models.ClaimStatus.Rejected:
                                            <span class="badge bg-danger fs-6"><i class="bi bi-x-circle"></i> Rejected</span>
                                            break;
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Submitted Date</label>
                                <p class="form-control-plaintext">@Model.SubmittedAt.ToString("MMMM dd, yyyy")</p>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.DocumentPath))
                    {
                        <div class="mb-3">
                            <label class="form-label fw-bold">Supporting Document</label>
                            <div>
                                <a href="~/uploads/@Model.DocumentPath" target="_blank" class="btn btn-outline-primary">
                                    <i class="bi bi-download"></i> Download Document
                                </a>
                                <small class="text-muted ms-2">@Model.DocumentPath</small>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Action Panel -->
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h6 class="card-title mb-0"><i class="bi bi-gear"></i> Actions</h6>
                </div>
                <div class="card-body">
                    @if (Model.Status == CMCSWeb.Models.ClaimStatus.Pending)
                    {
                        <div class="d-grid gap-2">
                            <form asp-action="Verify" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@Model.Id" />
                                <button type="submit" class="btn btn-success w-100 mb-2">
                                    <i class="bi bi-check-circle"></i> Verify Claim
                                </button>
                            </form>

                            <form asp-action="Reject" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@Model.Id" />
                                <button type="submit" class="btn btn-danger w-100"
                                        onclick="return confirm('Are you sure you want to reject this claim?')">
                                    <i class="bi bi-x-circle"></i> Reject Claim
                                </button>
                            </form>
                        </div>
                    }
                    else if (Model.Status == CMCSWeb.Models.ClaimStatus.Verified)
                    {
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> This claim has been verified and is awaiting manager approval.
                        </div>
                    }
                    else if (Model.Status == CMCSWeb.Models.ClaimStatus.Approved)
                    {
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i> This claim has been approved by the manager.
                        </div>
                    }
                    else if (Model.Status == CMCSWeb.Models.ClaimStatus.Rejected)
                    {
                        <div class="alert alert-danger">
                            <i class="bi bi-x-circle"></i> This claim has been rejected.
                        </div>
                    }

                    <hr>
                    <div class="text-center">
                        <a asp-action="Manage" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-list-ul"></i> Back to All Claims
                        </a>
                    </div>
                </div>
            </div>

            <!-- Claim Timeline -->
            <div class="card shadow mt-4">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0"><i class="bi bi-clock-history"></i> Claim Timeline</h6>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item @(Model.Status >= CMCSWeb.Models.ClaimStatus.Pending ? "completed" : "")">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <strong>Submitted</strong>
                                <div class="text-muted small">@Model.SubmittedAt.ToString("MMM dd, yyyy HH:mm")</div>
                            </div>
                        </div>

                        @if (Model.VerifiedAt.HasValue)
                        {
                            <div class="timeline-item completed">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Verified by Coordinator</strong>
                                    <div class="text-muted small">@Model.VerifiedAt.Value.ToString("MMM dd, yyyy HH:mm")</div>
                                    <div class="text-muted small">By: @Model.VerifiedBy</div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="timeline-item @(Model.Status >= CMCSWeb.Models.ClaimStatus.Verified ? "completed" : "")">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Awaiting Verification</strong>
                                    <div class="text-muted small">Pending coordinator review</div>
                                </div>
                            </div>
                        }

                        @if (Model.ApprovedAt.HasValue)
                        {
                            <div class="timeline-item completed">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Approved by Manager</strong>
                                    <div class="text-muted small">@Model.ApprovedAt.Value.ToString("MMM dd, yyyy HH:mm")</div>
                                    <div class="text-muted small">By: @Model.ApprovedBy</div>
                                </div>
                            </div>
                        }
                        else if (Model.Status == CMCSWeb.Models.ClaimStatus.Verified)
                        {
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Awaiting Manager Approval</strong>
                                    <div class="text-muted small">Ready for final approval</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .timeline {
        position: relative;
        padding-left: 20px;
    }

    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }

    .timeline-marker {
        position: absolute;
        left: -20px;
        top: 0;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: #6c757d;
        border: 2px solid white;
    }

    .timeline-item.completed .timeline-marker {
        background-color: #198754;
    }

    .timeline-item:not(:last-child)::after {
        content: '';
        position: absolute;
        left: -15px;
        top: 12px;
        bottom: -20px;
        width: 2px;
        background-color: #dee2e6;
    }

    .timeline-item.completed:not(:last-child)::after {
        background-color: #198754;
    }

    .timeline-content {
        padding-bottom: 10px;
    }
</style>